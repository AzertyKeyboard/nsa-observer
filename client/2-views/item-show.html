<template name="itemShow">
    <div class="panel-head">
         <div class="panel-close"><a href="" title="Click here or press ESC to return to homepage">X</a></div>
        {{>nav}}
    </div>

    {{# if currentItemExists }}
        <div class="btn-group edit-nav">
        {{# if canEdit  }}
            {{#if mode "edit"}}
                <a class="btn item-save" href="#">
                    Save item
                </a>
                <a class="btn view-mode" href="#">
                    Return to view mode 
                </a>
            {{ else }}
                <a class="btn edit-mode" href="#">
                    Edit items
                </a>
            {{/if}}
            {{# if draftsNum }}
                <a class="btn drafts-mode" href="#">
                    Show {{draftsNum}} drafts
                </a>
            {{/if}}
            {{# if versionsNum }}
                <a class="btn versions-mode" href="#">
                    Show {{versionsNum}} versions
                </a>
            {{/if}}

        {{/if}}
        </div>

        {{# if mode "drafts"}}
            <h3>
                Drafts list
            </h3>
            {{#if draftsNum}}
                {{> itemDrafts }}
            {{else}}
                No drafts
            {{/if}}
        {{/if}}

        {{# if mode "versions"}}
            <h3>
                Versions list
            </h3>
            {{> itemVersions }}
        {{/if}}
        

        {{#if mode "edit"}}
            {{# if inEditModeWikiÂ }}
            <div class="wiki-edit-wrapper">
                {{> itemWiki currentItem}}
            </div>
            {{else}}
                <form class="data-form">
                   <dl class="dl-horizontal">
                    <dt>Description
                    <dd>
                    <textarea class="input-xxlarge item-data" name="description">{{{ currentItem.description }}}</textarea>
                    <dt>Category
                    <dd><input type="text" class="input-large item-data" name="category" value="{{ currentItem.category }}">
                    <dt>Family
                    <dd><input type="text" class="input-large item-data" name="family" value="{{ currentItem.family}}">
                    <dt>Related items
                    <dd><input type="text" class="input-xxlarge item-data" name="relatedItems" value="{{editRelatedItems}}">
                    <dt>Links
                    <dd><textarea class="item-data" name="externalLinks[]" >{{editExternalLink}}</textarea>
                    </dl>
                </form>
            {{/if}}
        {{/if}}
            
        {{#if mode "view" }}
            {{#with currentItem}}
                <h3 class="item-data" >
                    <a href="{{pathFor 'category-family-name'}}">
                        {{ name }}
                    </a>
                </h3>
                <div class="item-show">
                    <dl class="dl-horizontal">
                        <dt>Description
                        <dd><p class="item-data" >
                                {{{wikiLinks currentItem.description }}}&nbsp;
                            </p>
                        <dt>Category
                        <dd>
                            <a href="{{pathFor 'category'}}" class="item-show-link category-link" category="{{ category }}">
                                {{ category }}
                            </a>&nbsp;
                        <dt>Family
                        <dd><a href="{{pathFor 'category-family'}}" class="item-show-link family-link" category="{{ category }}" family="{{ family }}">{{ family }}</a>&nbsp;
                        <dt>Agency
                        <dd>{{ agency }}&nbsp;
                        <dt>Compartments
                        <dd class="item-ul">
                        <ul>
                        {{#each compartments}}
                            {{#if this }}
                                <li>{{{wikiLinks this}}}
                            {{/if}}
                        {{/each}}
                        </ul>&nbsp;
                        <dt>Related items
                        <dd class="item-ul">
                        <ul>
                        {{#each relatedItems}}
                            {{#if this }}
                                <li>{{{wikiLinks this}}}
                            {{/if}}
                        {{/each}}
                        </ul>&nbsp;
                        <dt>Parents
                        <dd class="item-ul">
                        <ul>
                        {{#each relatedItemsParents}}
                            {{#if this }}
                                <li>{{{wikiLinks this}}}
                            {{/if}}
                        {{/each}}
                        </ul>&nbsp;
                        <dt>Children
                        <dd class="item-ul">
                        <ul>
                        {{#each relatedItemsChildren}}
                            {{#if this }}
                                <li>{{{wikiLinks this}}}
                            {{/if}}
                        {{/each}}
                        </ul>&nbsp;
                        <dt>Sources
                        <dd class="item-ul">
                            <ul class='external-links-wrapper'>
                            {{#each links}}
                            {{{ showExternalLink this }}}
                            {{/each}}
                            </ul>&nbsp;
                    </dl>
                </div>
                <div class="item-graph">{{#constant}}{{/constant}}</div>
            {{/with}}
    {{/ if }}
{{/ if }}
</template>